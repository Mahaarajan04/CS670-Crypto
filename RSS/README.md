
# **Secure Matrix Updates via 3-Party Additive Random Secret Sharing (RSS) (3,1) RSS**

| **Name**       | **Roll Number** | **Email**                  |
|----------------|-----------------|-----------------------------|
| Mahaarajan J   | 220600          | mahaarajan22@iitk.ac.in     |

---

## **Overview**

This protocol securely updates a private matrix `U` using additive secret-sharing among three parties (P0, P1, P2). Each party holds secret shares of the matrices `U`, `V`, and the query vector `j`, and updates are computed securely using masked communication and additive homomorphism.

---

## **How to Run (Docker)**

### 1. Prune Docker

```bash
docker container prune -f
````

### 2. Edit `.env` file

```bash
P=3
T=1
N=32
M=7
K=122
Q=252
```

These specify:

* `N`: number of item vectors
* `M`: number of user vectors
* `K`: embedding dimension
* `Q`: number of queries

### 3. Build & Run

```bash
docker-compose up --build
```

Launched services:

* `gen_queries_rss`: generates secret shares for queries.
* `rss_p0`, `rss_p1`, `rss_p2`: three parties executing the RSS protocol.
* `dealer`: trusted setup party to generate shared randomness.

Output will be written to `./data/`.

---

## **Key Features**

* Random secret sharing among 3 parties
* Oblivious computation of `vj = V[j]` using dot-products with shared queries
* Secure delta computation: `δ = 1 − ⟨ui, vj⟩`
* Secure update: `ui ← ui + δ · vj` under secret shares
* zero-sharing to blind and circulate shares

---

## **Design Highlights**

* All communication is done via TCP sockets using asynchronous co-routines.

* Parties use a consistent left-right neighbor mapping:

  * **P0**: Right = P1, Left = P2
  * **P1**: Right = P2, Left = P0
  * **P2**: Right = P0, Left = P1

* 0 shares are generated by `dealer` and distributed to all parties **before** queries begin.

* Then each party computes its respective additive secret share then communicates in a ring by blinding with 0 shares (send right recieve left)

* Each query goes through:

  1. Oblivious computation of `vj`
  2. Secure computation of δ
  3. Secure update of `ui`

---

## **Files**

| File                 | Description                                                                  |
| -------------------- | ---------------------------------------------------------------------------- |
| `dealer.cpp`         | Dealer that distributes shared zeroes and seeds                              |
| `gen_queries.cpp`    | Generates additive shares of queries                                         |
| `pB.cpp`             | Logic for each peer (P0, P1, P2)                                             |
| `common.hpp`         | Common utility functions                                                                
| `docker-compose.yml` | Launches all parties in isolated containers                                  |
| `Dockerfile`         | Builds executables for each role                                             |
| `.env`               | Sets `N`, `M`, `K`, `Q` values for query generation and party initialization |
| `checker.cpp`               | Checks if files produced are  valid 
|
| `test.py`               | Automated pipeline with initialisation and testing |

---

## **Data Files Generated**

| File                                      | Description                                                  |
| ----------------------------------------- | ------------------------------------------------------------ |
| `queries_i.txt`                           | Indices `i` of users (public)                                |
| `queries_0_1.txt`, `queries_0_2.txt`, ... | Additive shares of `j` vector                                |
| `vjshares0_X.txt`, `vjshares1_X.txt`      | Two additive shares of vector `vj` for party X               |
| `deltas0_X.txt`, `deltas1_X.txt`          | Additive shares of scalar δ for party X                      |
| `updated_ui0_X.txt`, `updated_ui1_X.txt`  | Updated `ui` shares per party X                              |
| `U_X_Y.txt`, `V_X_Y.txt`                  | Matrix share files for debugging (X = role, Y = share index) |

---
